<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="Content-Style-Type" content="text/css" />
        <title></title>
        
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />
    </head>
    <body>
    </body>
    
    <script type="text/javascript">
        
        var log = [
            {date: "2016-12-25", category: "Available to Budget", description: "Lynnwoodhof Deposit", amount: 10400, type: "Transfer", approved: false},
        
            {date: "2016-12-09", category: "Cleaning", description: "Budget Transfer", amount: 1250, type: "Transfer", approved: false},
            {date: "2016-12-09", category: "Available to Budget", description: "Budget Transfer", amount: -1250, type: "Transfer", approved: false},
            {date: "2016-12-09", category: "Holiday 2016", description: "Christmas", amount: 4500, type: "Transfer", approved: false},
            {date: "2016-12-09", category: "Available to Budget", description: "Christmas", amount: -4500, type: "Transfer", approved: false},
            {date: "2016-12-09", category: "Available to Budget", description: "Pay Jessi back", amount: -1500, type: "Transaction", approved: false},
            {date: "2016-12-09", category: "Available to Budget", description: "Spartan Deposit", amount: 5400, type: "Transfer", approved: false},
            
            {date: "2016-12-08", category: "Holiday 2016", description: "for Picnic in January", amount: -600, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "for Date Night", amount: -400, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "for Ebbie Swart", amount: -100, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Holiday 2016", description: "for Present for Jessi", amount: -539, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "for stationary for Jessi", amount: -135.60, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "for Sushi Lunch", amount: -201, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Holiday 2016", description: "to Jessi for Gifts that she bought", amount: -900, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Electricity", description: "towards Prepaid Electricity for 3 Villa Marelu", amount: -500, type: "Transaction", approved: true},
            
            {date: "2016-12-07", category: "Holiday 2016", description: "Budget Transfer", amount: 4600, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Available to Budget", description: "Budget Transfer", amount: -4600, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Daily Living", description: "Lunch", amount: -31.50, type: "Transaction", approved: true},
            {date: "2016-12-07", category: "Daily Living", description: "Budget Transfer", amount: 18.21, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Bank Charges", description: "Budget Transfer", amount: -18.21, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Bank Charges", description: "FNB", amount: 1.85, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Bank Charges", description: "FNB", amount: -25.90, type: "Transaction", approved: true},
            
            {date: "2016-12-06", category: "Available to Budget", description: "from Dad for Holiday Gift", amount: 5000, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Daily Living", description: "Budget Transfer", amount: 2064.60, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "Budget Transfer", amount: -2064.60, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "eToll", description: "Budget Transfer", amount: 250, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "Budget Transfer", amount: -250, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Bank Charges", description: "Budget Transfer", amount: 42.26, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "Budget Transfer", amount: -42.26, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Electricity", description: "that is going towards Electricity", amount: 550, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "to give it a job", amount: -550, type: "Transfer", approved: true},
            
            {date: "2016-12-05", category: "Available to Budget", description: "to set Current Balance", amount: 4356.86, type: "Transfer", approved: true},
        ];
        
        // Get distinct categories
        categories = {};
        log.forEach(function(entry){
            categories[entry.category] = true;
        });
        
        container = document.createElement("div");
        container.className = "page-header";
        container.style.margin = "20px";
        document.body.appendChild(container);

        header = document.createElement("h1");
        header.innerHTML = "Current View";
        container.appendChild(header);
        
        container = document.createElement("div");
        container.style.width = "30%";
        container.style.margin = "20px";
        document.body.appendChild(container);
        
        table = document.createElement("table");
        table.className = "table table-striped table-bordered";
        container.appendChild(table);
        
        thead = document.createElement("thead");
        table.appendChild(thead);
        
        tr = document.createElement("tr");
        thead.appendChild(tr);
        
        th = document.createElement("th");
        th.innerHTML = "Category";
        tr.appendChild(th);
        
        th = document.createElement("th");
        th.innerHTML = "Initial";
        tr.appendChild(th);
        
        th = document.createElement("th");
        th.innerHTML = "Available";
        tr.appendChild(th);
        
        tbody = document.createElement("tbody");
        table.appendChild(tbody);
    
        Object.keys(categories).sort().forEach(function(key){
            tr = document.createElement("tr");
            
            td = document.createElement("td");
            tr.appendChild(td);
            td.innerHTML = key;
            
            var initial = log.reduce(function(accumulator, entry){
                return accumulator + ((entry.category === key && entry.type === "Transfer" && entry.approved) ? entry.amount : 0);
            }, 0);
            initial = Math.round(initial * 100) / 100;

            td = document.createElement("td");
            tr.appendChild(td);
            td.innerHTML = initial;
            
            var spent = log.reduce(function(accumulator, entry){
                return accumulator + ((entry.category === key && entry.type === "Transaction" && entry.approved) ? entry.amount : 0);
            }, 0);
            spent = Math.round(spent * 100) / 100;
            
            td = document.createElement("td");
            tr.appendChild(td);
            td.innerHTML = initial + spent;
            
            if (initial === initial + spent) {
                tr.className = "success";
            }
            if (initial + spent === 0) {
                tr.className = "danger";
            }

            if (initial + spent > 0) {
                tbody.appendChild(tr);
            }
        });
        
        tr = document.createElement("tr");
        
        td = document.createElement("td");
        tr.appendChild(td);
        b = document.createElement("b");
        b.innerHTML = "Available Balance";
        td.appendChild(b);
        td = document.createElement("td");
        tr.appendChild(td);
        
        var initial = log.reduce(function(accumulator, entry){
            return accumulator + ((entry.type === "Transfer" && entry.approved) ? entry.amount : 0);
        }, 0);
        initial = Math.round(initial * 100) / 100;
        
        var spent = log.reduce(function(accumulator, entry){
            return accumulator + ((entry.type === "Transaction" && entry.approved) ? entry.amount : 0);
        }, 0);
        spent = Math.round(spent * 100) / 100;
        
        td = document.createElement("td");
        td.innerHTML = "<b>" + (Math.round((initial + spent) * 100) / 100) + "</br>";
        tr.appendChild(td);
        
        tbody.appendChild(tr);
        
        container = document.createElement("div");
        container.className = "page-header";
        container.style.margin = "20px";
        document.body.appendChild(container);

        header = document.createElement("h1");
        header.innerHTML = "Transaction Sheet";
        container.appendChild(header);
        
        container = document.createElement("div");
        container.style.width = "90%";
        container.style.margin = "20px";
        document.body.appendChild(container);
        
        table = document.createElement("table");
        table.className = "table table-striped table-bordered";
        container.appendChild(table);
        
        thead = document.createElement("thead");
        table.appendChild(thead);
        
        tr = document.createElement("tr");
        thead.appendChild(tr);
        
        th = document.createElement("th");
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Date";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Type";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Category";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Description";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Amount";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Result";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Approved";
        tr.appendChild(th);
        
        var tbody = document.createElement("tbody");
        table.appendChild(tbody);
        
        log.forEach(function(entry, index){
            var tr = document.createElement("tr");
            var td = document.createElement("td");
            
            tr.appendChild(td);
            tbody.appendChild(tr);
            
            td.innerHTML = log.length - index;
            
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.date;
            
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = (entry.type === "Transfer" ? "Move " : "Pay ") + Math.abs(entry.amount) + " " + (entry.amount < 0 ? "out of" : "into");
                    
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.category;
                    
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.description;
                    
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.amount;
                    
            balance = 0;
            for (i = log.length - 1; i >= index; i--) {
                if (entry.category === log[i].category) {
                    balance += log[i].amount;
                }
            }
            balance = Math.round(balance * 100) / 100;
            
            previous = (balance - entry.amount);
            previous = Math.round(previous * 100) / 100;
            
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.category + " went from " + previous + " to " + balance
                    
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.approved ? "Yes" : "No";
            
            if (!entry.approved) {
                tr.className = "warning";
            }
            
            if (balance === 0) {
                tr.className = "danger";
            }
        });
    
    </script>
</html>
