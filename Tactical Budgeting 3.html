<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="Content-Style-Type" content="text/css" />
        <title></title>
        
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />
    </head>
    <body>
    </body>
    
    <script type="text/javascript">
        
        var log = [
            {date: "2016-12-25", category: "Available to Budget", description: "Topup Emergency Fund", amount: -10000, type: "Transaction", approved: false},
            {date: "2016-12-25", category: "Available to Budget", description: "Lynnwoodhof Deposit", amount: 10400, type: "Transaction", approved: false},
            
            {date: "2016-12-15", category: "Surplus", description: "Gift for Clean Parents", amount: -6000, type: "Transaction", approved: false},
            {date: "2016-12-15", category: "Cleaning", description: "Anna Salary & Bonus", amount: -2500, type: "Transaction", approved: false},
            {date: "2016-12-15", category: "Shelter", description: "3 Villa Marelu", amount: -8500, type: "Transaction", approved: false},
            {date: "2016-12-15", category: "Surplus", description: "Amend Surplus Budget", amount: 6000, type: "Transfer", approved: false},
            {date: "2016-12-15", category: "Available to Budget", description: "Make available for Surplus", amount: -6000, type: "Transfer", approved: false},
            {date: "2016-12-15", category: "Cleaning", description: "Amend Cleaning Budget", amount: 1250, type: "Transfer", approved: false},
            {date: "2016-12-15", category: "Available to Budget", description: "Make available for Cleaning", amount: -1250, type: "Transfer", approved: false},
            {date: "2016-12-15", category: "Shelter", description: "Amend Shelter Budget", amount: 8500, type: "Transfer", approved: false},
            {date: "2016-12-15", category: "Available to Budget", description: "Make available for Shelter", amount: -8500, type: "Transfer", approved: false},
            {date: "2016-12-15", category: "Available to Budget", description: "Pfortner (PTY) Ltd Salary", amount: 32062.77, type: "Transaction", approved: false},
        
            {date: "2016-12-10", category: "Cleaning", description: "Amend Cleaning Budget", amount: 874.30, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "Available to Budget", description: "Make available for Cleaning", amount: -874.30, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "Cleaning", description: "Amend Cleaning Budget", amount: 375.70, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "Daily Living", description: "Make available for Cleaning", amount: -375.70, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "Holiday 2016", description: "Amend Holiday 2016 Budget", amount: 4500, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "Available to Budget", description: "Make available for Holiday 2016", amount: -4500, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "Available to Budget", description: "Pay Jessi back", amount: -1500, type: "Transaction", approved: true},
            {date: "2016-12-10", category: "Water Bill", description: "Amend Water Bill Budget", amount: 250, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "eToll", description: "Make available for Water Bill", amount: -250, type: "Transfer", approved: true},
            {date: "2016-12-10", category: "Available to Budget", description: "Spartan Deposit", amount: 5024.30, type: "Transaction", approved: true},
            
            {date: "2016-12-09", category: "Daily Living", description: "Bachelors", amount: -59.99, type: "Transaction", approved: true},
            {date: "2016-12-09", category: "Daily Living", description: "Bachelors", amount: -137.67, type: "Transaction", approved: true},
            {date: "2016-12-09", category: "Daily Living", description: "Lunch", amount: -30.70, type: "Transaction", approved: true},
            
            {date: "2016-12-08", category: "Holiday 2016", description: "January Birthday Picnic", amount: -600, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "Date Night", amount: -400, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "Ebbie Swart Mannegroep vleis", amount: -100, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Holiday 2016", description: "Present for Jessi", amount: -539, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "Stationary for Jessi", amount: -135.60, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Daily Living", description: "Sushi Lunch", amount: -201, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Holiday 2016", description: "Jessi Christmas gifts for family", amount: -900, type: "Transaction", approved: true},
            {date: "2016-12-08", category: "Electricity", description: "Prepaid Electricity for 3 Villa Marelu", amount: -500, type: "Transaction", approved: true},
            
            {date: "2016-12-07", category: "Holiday 2016", description: "Amend Holiday 2016 Budget", amount: 4600, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Available to Budget", description: "Make available for Holiday 2016", amount: -4600, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Daily Living", description: "Lunch", amount: -31.50, type: "Transaction", approved: true},
            {date: "2016-12-07", category: "Daily Living", description: "Amend Daily Living Budget", amount: 18.21, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Bank Charges", description: "Make available for Daily Living", amount: -18.21, type: "Transfer", approved: true},
            {date: "2016-12-07", category: "Bank Charges", description: "FNB Rebate", amount: 1.85, type: "Transaction", approved: true},
            {date: "2016-12-07", category: "Bank Charges", description: "FNB Fees", amount: -25.90, type: "Transaction", approved: true},
            
            {date: "2016-12-06", category: "Available to Budget", description: "Holiday Gift from Dad", amount: 5000, type: "Transaction", approved: true},
            {date: "2016-12-06", category: "Daily Living", description: "Amend Daily Living Budget", amount: 2064.60, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "Make available for Daily Living", amount: -2064.60, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "eToll", description: "Amend eToll Budget", amount: 250, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "Make available for eToll", amount: -250, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Bank Charges", description: "Amend Bank Charges Budget", amount: 42.26, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "Make available for Bank Charges", amount: -42.26, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Electricity", description: "Amend Electricity Budget", amount: 550, type: "Transfer", approved: true},
            {date: "2016-12-06", category: "Available to Budget", description: "Make available for Electricity", amount: -550, type: "Transfer", approved: true},
            
            {date: "2016-12-05", category: "Available to Budget", description: "Current Balance", amount: 4356.86, type: "Transaction", approved: true},
        ];
        
        // Get distinct categories
        categories = {};
        log.forEach(function(entry){
            categories[entry.category] = true;
        });
        
        container = document.createElement("div");
        container.className = "page-header";
        container.style.margin = "20px";
        document.body.appendChild(container);

        header = document.createElement("h1");
        header.innerHTML = "Current View";
        container.appendChild(header);
        
        container = document.createElement("div");
        container.style.width = "30%";
        container.style.margin = "20px";
        document.body.appendChild(container);
        
        table = document.createElement("table");
        table.className = "table table-striped table-bordered";
        container.appendChild(table);
        
        thead = document.createElement("thead");
        table.appendChild(thead);
        
        tr = document.createElement("tr");
        thead.appendChild(tr);
        
        th = document.createElement("th");
        th.innerHTML = "Category";
        tr.appendChild(th);
        
        // th = document.createElement("th");
        // th.innerHTML = "Initial";
        // tr.appendChild(th);
        
        th = document.createElement("th");
        th.innerHTML = "Available";
        tr.appendChild(th);
        
        tbody = document.createElement("tbody");
        table.appendChild(tbody);
    
        Object.keys(categories).sort().forEach(function(key){
            tr = document.createElement("tr");
            
            td = document.createElement("td");
            tr.appendChild(td);
            td.innerHTML = key;
            
            var initial = log.reduce(function(accumulator, entry){
                return accumulator
                + ((entry.category === key && entry.type === "Transfer" && entry.approved) ? entry.amount : 0)
                + ((entry.category === key && entry.type === "Transaction" && entry.approved && entry.amount > 0) ? entry.amount : 0);
            }, 0);
            initial = Math.round(initial * 100) / 100;

            //td = document.createElement("td");
            //tr.appendChild(td);
            //td.innerHTML = "R" + initial;
            
            var spent = log.reduce(function(accumulator, entry){
                return accumulator + ((entry.category === key && entry.type === "Transaction" && entry.approved && entry.amount < 0) ? entry.amount : 0);
            }, 0);
            spent = Math.round(spent * 100) / 100;
            
            td = document.createElement("td");
            tr.appendChild(td);
            td.innerHTML = "R" + Math.round((initial + spent) * 100) / 100;
            
            if (initial === initial + spent) {
                tr.className = "success";
            }
            if (initial + spent === 0) {
                tr.className = "danger";
            }

            if (initial + spent > 0) {
                tbody.appendChild(tr);
            }
        });
        
        // Available Balance
        tr = document.createElement("tr");
        td = document.createElement("td");
        tr.appendChild(td);
        b = document.createElement("b");
        b.innerHTML = "TOTAL";
        td.appendChild(b);
        td = document.createElement("td");
        //tr.appendChild(td);
        
        var initial = log.reduce(function(accumulator, entry){
            return accumulator + ((entry.type === "Transfer" && entry.approved) ? entry.amount : 0);
        }, 0);
        initial = Math.round(initial * 100) / 100;
        
        var spent = log.reduce(function(accumulator, entry){
            return accumulator + ((entry.type === "Transaction" && entry.approved) ? entry.amount : 0);
        }, 0);
        spent = Math.round(spent * 100) / 100;
        
        td = document.createElement("td");
        td.innerHTML = "<b>R" + (Math.round((initial + spent) * 100) / 100) + "</br>";
        tr.appendChild(td);
        
        tbody.appendChild(tr);
        
        // Unaccounted Balance
        tr = document.createElement("tr");
        td = document.createElement("td");
        tr.appendChild(td);
        b = document.createElement("b");
        b.innerHTML = "Unaccounted";
        td.appendChild(b);
        td = document.createElement("td");
        //tr.appendChild(td);
        
        var transfers = log.reduce(function(accumulator, entry){
            return accumulator + ((entry.type === "Transfer") ? entry.amount : 0);
        }, 0);
        transfers = Math.round(initial * 100) / 100;
        
        td = document.createElement("td");
        td.innerHTML = "<b>R" + Math.abs(transfers) + "</br>";
        tr.appendChild(td);
        
        tbody.appendChild(tr);
        
        // Transaction List
        container = document.createElement("div");
        container.className = "page-header";
        container.style.margin = "20px";
        document.body.appendChild(container);

        header = document.createElement("h1");
        header.innerHTML = "Transaction Sheet";
        container.appendChild(header);
        
        container = document.createElement("div");
        container.style.width = "90%";
        container.style.margin = "20px";
        document.body.appendChild(container);
        
        table = document.createElement("table");
        table.className = "table table-striped table-bordered";
        container.appendChild(table);
        
        thead = document.createElement("thead");
        table.appendChild(thead);
        
        tr = document.createElement("tr");
        thead.appendChild(tr);
        
        th = document.createElement("th");
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Date";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Type";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Category";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Description";
        tr.appendChild(th);
        th = document.createElement("th");
        th.innerHTML = "Result";
        tr.appendChild(th);
        
        var tbody = document.createElement("tbody");
        table.appendChild(tbody);
        
        log.forEach(function(entry, index){
            var tr = document.createElement("tr");
            var td = document.createElement("td");
            
            tr.appendChild(td);
            tbody.appendChild(tr);
            
            td.innerHTML = log.length - index;
            
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.date;
            
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            if (entry.amount > 0) {
                td.innerHTML = "R" + entry.amount + (entry.approved ? " got " : " will get ") + (entry.type === "Transfer" ? "moved" : "paid") + " into ";
            }
            else{
                td.innerHTML = "R" + Math.abs(entry.amount) + (entry.approved ? " got " : " will get ") + (entry.type === "Transfer" ? "moved" : "paid") + " out of ";
            }
                    
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.category;
                    
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.description;
                    
            balance = 0;
            for (i = log.length - 1; i >= index; i--) {
                if (entry.category === log[i].category) {
                    balance += log[i].amount;
                }
            }
            balance = Math.round(balance * 100) / 100;
            
            previous = (balance - entry.amount);
            previous = Math.round(previous * 100) / 100;
            
            td = document.createElement("td");
            tr.appendChild(td);
            tbody.appendChild(tr);
            td.innerHTML = entry.category + (entry.approved ? " went " : " will go ") + "from R" + previous + " to R" + balance
            
            if (!entry.approved) {
                tr.className = "info";
            }
            
            if (balance === 0) {
                tr.className = "warning";
            }
            
            if (balance < 0) {
                tr.className = "danger";
            }
            
            if (entry.amount > 0 && entry.type === "Transaction") {
                tr.className = "success";
            }
        });
    
    </script>
</html>
