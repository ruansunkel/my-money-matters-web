<html>

<head>
    <title>MyMoneyMatters - Cent Visual</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript">
        /* FORMATTING FUNCTIONS */
        function roundToTwoDecimalPlaces(number) {
            return Math.round(number * 100) / 100;
        }

        function formatForDisplay(number) {
            return roundToTwoDecimalPlaces(number).toLocaleString('en-ZA', {
                style: 'currency',
                currency: 'ZAR'
            });
        }

        nodes = [
            [
                [
                    [32062.77, "#5ae2ba", "Stream 1"]
                ],
                [
                    [11655, "#5ae2ba", "Stream 2"]
                ]
            ],
            [
                [
                    [21874.82, "url(#gradientFixed)", "Fixed Expences"],
                    [11293.95, "url(#gradientLiving)", "Living Expences"],
                    [10000.00, "#5ae2ba", "Goals"],
                ]
            ],
            [
                [
                    [4078.50, "url(#gradientDebt)", "DEBT"],
                    [607.50, "url(#gradientDebt)", "DEBT"],

                    [8500, "url(#gradientImportant)", "Rent"],
                    [3129, "url(#gradientNotSoImportant)", "Medical Aid"],
                    [2205.05, "url(#gradientNotSoImportant)", "Sanlam Policies"],
                    [1500, "url(#gradientNotSoImportant)", "Domestic Work"],
                    [751.46, "url(#gradientNotSoImportant)", "Car Insurance"],
                    [400, "url(#gradientNotSoImportant)", "Electricity"],
                    [253.41, "url(#gradientNotSoImportant)", "Car Service Plan"],
                    [250, "url(#gradientNotSoImportant)", "Municipal Rates"],
                    [200, "url(#gradientNotSoImportant)", "Bank Fees"]
                ],
                [
                    [6793.95, "#47e54a", "Groceries"],
                    [2500, "#47e54a", "Fun"],
                    [2000, "#47e54a", "Petrol"],
                ]
            ]
        ];

        function drawChart(root, nodeList, savingExpencesList) {
            nodeList[2][2] = (savingExpencesList);
            sankey(root, nodeList, "100%", "500px");
        }

        function createPanel(root, title, context) {
            panelHeading = document.createElement("div");
            root.appendChild(panelHeading);

            heading = document.createElement("h3");
            heading.innerHTML = title;
            panelHeading.appendChild(heading);

            panelBody = document.createElement("div");
            root.appendChild(panelBody);

            return root;
        }

        function drawCharts(root) {
            // March
            nodeList = nodes.slice();
            nodeList[2][0][0][0] += 549;
            nodeList[1][0][0][0] += 549;
            drawChart(createPanel(root, "March 2017", "success"), nodes, [
                [10000, "url(#gradientLiquidDebt)", "DEBT"],
            ]);

            // April
            nodeList[0][0][0][0] += 2537.23;
            nodeList[2][0][0][0] += 2537.23;
            nodeList[1][0][0][0] += 2537.23;
            drawChart(createPanel(root, "April 2017", "info"), nodeList, [
                [10000, "#5ae2ba", "Creativity Fund"],
            ]);

            // May
            drawChart(createPanel(root, "May 2017", "info"), nodeList, [
                [10000, "url(#gradientInvestment)", "Chalet Fund"],
            ]);

            // June
            drawChart(createPanel(root, "June 2017", "info"), nodeList, [
                [10000, "#5ae2ba", "Birthday Fund"],
            ]);
            // July
            drawChart(createPanel(root, "July 2017", "info"), nodeList, [
                [10000, "url(#gradientLiquidDebt)", "DEBT"],
            ]);
            // August
            drawChart(createPanel(root, "August 2017", "info"), nodeList, [
                [10000, "url(#gradientLiquidDebt)", "DEBT"],
            ]);

            // September
            nodeList[2][0][0][0] += 607.50;
            nodeList[2][0].splice(1, 1);
            drawChart(createPanel(root, "September 2017", "info"), nodeList, [
                [10000, "url(#gradientLiquidDebt)", "DEBT"],
            ]);

            // October
            drawChart(createPanel(root, "October 2017", "info"), nodeList, [
                [10000, "#5ae2ba", "Birthday Fund"],
            ]);

            // November
            drawChart(createPanel(root, "November 2017", "info"), nodeList, [
                [10000, "#5ae2ba", "Christmas Fund"],
            ]);

            // December
            drawChart(createPanel(root, "December 2017", "info"), nodeList, [
                [10000, "#5ae2ba", "Holiday Fund"],
            ]);

            // January
            nodeList[1][0][0][0] -= 7772.23;
            nodeList[1][0][2][0] += 7772.23;
            nodeList[2][0].splice(0, 1);

            drawChart(createPanel(root, "January 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "February 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "March 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "April 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "May 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "June 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Birthday Fund"]
            ]);

            drawChart(createPanel(root, "July 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "August 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "September 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Reserve"]
            ]);

            drawChart(createPanel(root, "October 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Birthday Fund"]
            ]);

            drawChart(createPanel(root, "November 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Christmas Fund"]
            ]);

            drawChart(createPanel(root, "December 2018", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Holiday Fund"]
            ]);

            drawChart(createPanel(root, "January 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "February 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "March 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "April 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "May 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "June 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Birthday Fund"]
            ]);

            drawChart(createPanel(root, "July 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "August 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "September 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "url(#gradientInvestment)", "Education Fund"]
            ]);

            drawChart(createPanel(root, "October 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Birthday Fund"]
            ]);

            drawChart(createPanel(root, "November 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Christmas Fund"]
            ]);

            drawChart(createPanel(root, "December 2019", "info"), nodes, [
                [nodeList[1][0][2][0], "#5ae2ba", "Holiday Fund"]
            ]);
        }

        function createLinearGradient(root, id, startColor, endColor) {
            linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            linearGradient.setAttribute("id", id);
            root.appendChild(linearGradient);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "0%");
            stop.setAttribute("stop-color", startColor);
            linearGradient.appendChild(stop);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "70%");
            stop.setAttribute("stop-color", endColor);
            linearGradient.appendChild(stop);
        }

        function sankey(root, nodes, width, height) {
            // Create Graph
            chart = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            chart.style.width = width;
            chart.style.height = height;
            root.appendChild(chart);

            // Gradients
            defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            chart.appendChild(defs);

            createLinearGradient(defs, "gradientFixed", "#5ae2ba", "rgb(255, 149, 0)");
            createLinearGradient(defs, "gradientLiving", "#5ae2ba", "#47e54a");
            createLinearGradient(defs, "gradientDebt", "rgb(255, 149, 0)", "rgb(255, 59, 48)");
            createLinearGradient(defs, "gradientImportant", "rgb(255, 149, 0)", "rgb(255, 149, 0)");
            createLinearGradient(defs, "gradientNotSoImportant", "rgb(255, 149, 0)", "rgb(255, 149, 0)");
            createLinearGradient(defs, "gradientLiquidDebt", "#5ae2ba", "rgb(255, 59, 48)");
            createLinearGradient(defs, "gradientInvestment", "#5ae2ba", "rgb(90, 200, 250)");

            // Graph Properties
            graphWidth = chart.clientWidth - 160;
            graphHeight = chart.clientHeight;
            nodePadding = 18;

            maxChildNode = calculateMaxChildNode(nodes)
            maxNodeSum = calculateMaxNodeSum(nodes);
            scalingFactor = (graphHeight - (maxChildNode + 1) * nodePadding) / maxNodeSum;

            // Draw Values
            nodes.forEach(function(node, index) {
                x0 = index * graphWidth / nodes.length + (index == 0 ? nodePadding : 0);
                x1 = index + 1 < nodes.length ? (index + 1) * graphWidth / nodes.length : graphWidth - nodePadding;

                y0 = (graphHeight - (maxNodeSum * scalingFactor + (node.length - 1) * nodePadding)) / 2;
                y1 = index + 1 < nodes.length ? (graphHeight - (maxNodeSum * scalingFactor + (nodes[index + 1].length - 1) * nodePadding)) / 2 : nodePadding;

                node.forEach(function(child, childIndex) {
                    child.forEach(function(grandChild, grandChildIndex) {
                        value = grandChild[0] * scalingFactor;

                        chart.appendChild(createCurve(x0 - 0.5, y0 + value / 2, x1, y1 + value / 2, value, grandChild[1]));

                        if (index + 1 >= nodes.length) {
                            chart.appendChild(drawText(x1 + 10, y1 + value / 2 + 4.0, grandChild[2] + " (" + formatForDisplay(grandChild[0]) + ")"));
                        } else if (index == 0) {
                            chart.appendChild(drawText(x0 + 10, y0 + value / 2 + 5.5, grandChild[2] + " (" + formatForDisplay(grandChild[0]) + ")"));
                        } else {
                            chart.appendChild(drawText(x0 + 20, y0 + value / 2 + 5.5, grandChild[2] + " (" + formatForDisplay(grandChild[0]) + ")"));
                        }

                        if ((index + 1 < nodes.length && childIndex < nodes[index + 1].length && nodes[index + 1].length > 1) || (index + 1 >= nodes.length)) {
                            y1 += nodePadding;
                        }

                        y0 += node[childIndex][grandChildIndex][0] * scalingFactor;
                        y1 += node[childIndex][grandChildIndex][0] * scalingFactor;
                    });

                    y0 += nodePadding;
                });
            });

            // Drawing Functions
            function createCurve(x0, y0, x1, y1, height, color) {
                y1 += 0.001;

                path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", "M " + x0 + " " + y0 + " C " + (x0 + (x1 - x0) / 2) + " " + y0 + " " + (x0 + (x1 - x0) / 2) + " " + y1 + " " + x1 + " " + y1);
                path.setAttribute("stroke-width", height + "px");
                path.setAttribute("stroke", color);
                path.setAttribute("fill", "none");
                return path;
            }

            function drawRect(x, y, w, h, fill) {
                rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("x", x);
                rect.setAttribute("y", y);
                rect.setAttribute("width", w);
                rect.setAttribute("height", h);
                rect.style.fill = fill;
                return rect;
            }

            function drawText(x, y, value) {
                text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", x);
                text.setAttribute("y", y);
                text.setAttribute("font-size", "12px");
                text.innerHTML = value;
                return text;
            }

            function calculateMaxNodeSum(nodes) {
                total = 0;
                nodes[0].forEach(function(child) {
                    total += child.reduce(function(accumulator, grandChild) {
                        return accumulator + grandChild[0];
                    }, 0);
                });

                return total;
            }

            function calculateMaxChildNode(nodes) {
                total = 0;
                nodes.forEach(function(node) {
                    nodeCount = node.reduce(function(accumulator, child) {
                        return accumulator + child.length;
                    }, 0);

                    total = nodeCount > total ? nodeCount : total;
                });

                return total;
            }

            return chart;
        }
    </script>
</head>

<body>
    <div class="container-fluid">
        <div class="page-header">
            <h1><img src="https://www.mymoneymatters.co.za/images/cent/logo_250x250.png" style="width: 100px" />Visual Money Flow (Monthly)</h1>
        </div>

        <p>Tracking is the single most important step of budgeting. The result of tracking is absolute clarity about where your money goes. Use the Cent App for day to day tracking.</p>
    </div>

    <script type="text/javascript">
        drawCharts(document.getElementsByClassName("container-fluid")[0]);
    </script>
</body>

</html>