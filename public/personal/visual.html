<html>

<head>
    <title>Tactical Money Planning - Visual</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript">
        /* FORMATTING FUNCTIONS */
        function roundToTwoDecimalPlaces(number) {
            return Math.round(number * 100) / 100;
        }

        function formatForDisplay(number) {
            return roundToTwoDecimalPlaces(number).toLocaleString('en-ZA', {
                style: 'currency',
                currency: 'ZAR'
            });
        }

        nodes = [
            [
                [
                    [32062.77, "#5ae2ba", "Pfortner"]
                ],
                [
                    [11655, "#5ae2ba", "Young Engineers"]
                ]
            ],
            [
                [
                    [21892.82, "url(#gradientFixed)", "Fixed Expences"],
                    [11275.95, "url(#gradientLiving)", "Living Expences"],
                    [10549.00, "#5ae2ba", "Goals"],
                ]
            ],
            [
                [
                    [4078.50, "url(#gradientDebt)", "Car DEBT"],
                    [607.50, "url(#gradientDebt)", "Internet DEBT"],

                    [8500, "url(#gradientImportant)", "Rent"],
                    [3129, "url(#gradientNotSoImportant)", "Medical Aid"],
                    [2205.05, "url(#gradientNotSoImportant)", "Sanlam Policies"],
                    [1500, "url(#gradientNotSoImportant)", "Domestic Work"],
                    [751.46, "url(#gradientNotSoImportant)", "Car Insurance"],
                    [400, "url(#gradientNotSoImportant)", "Electricity"],
                    [253.41, "url(#gradientNotSoImportant)", "Car Service Plan"],
                    [250, "url(#gradientNotSoImportant)", "Municipal Rates"],
                    [200, "url(#gradientNotSoImportant)", "Bank Fees"],
                    [18, "url(#gradientNotSoImportant)", "Websites"]
                ],
                [
                    [6775.95, "#47e54a", "Groceries"],
                    [2500, "#47e54a", "Fun"],
                    [2000, "#47e54a", "Petrol"],
                ]
            ]
        ];

        function drawChart(root, savingExpencesList) {
            nodes[2][2] = (savingExpencesList);
            sankey(root, nodes, "100%", "500px");
        }

        function drawCharts() {
            drawChart(document.getElementById("sankey_basic2"), [
                [10000, "#5ae2ba", "Car Debt"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic3"), [
                [10000, "#5ae2ba", "House Fund"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic4"), [
                [10000, "#5ae2ba", "Chalet Fund"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic5"), [
                [10000, "#5ae2ba", "Birthday Fund"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic6"), [
                [10000, "#5ae2ba", "Car Debt"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic7"), [
                [10000, "#5ae2ba", "Car Debt"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic8"), [
                [10000, "#5ae2ba", "Car Debt"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic9"), [
                [10000, "#5ae2ba", "Birthday Fund"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic10"), [
                [10000, "#5ae2ba", "Christmas Fund"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic11"), [
                [10000, "#5ae2ba", "Holiday Fund"],
                [549, "#5ae2ba", "Car Debt"]
            ]);

            drawChart(document.getElementById("sankey_basic12"), [
                [10000, "#5ae2ba", "Holiday Fund"],
                [549, "#5ae2ba", "Car Debt"]
            ]);
        }

        function sankey(root, nodes, width, height) {
            // Create Graph
            chart = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            chart.style.width = width;
            chart.style.height = height;
            root.appendChild(chart);

            // Gradients
            defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            chart.appendChild(defs);


            linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            linearGradient.setAttribute("id", "gradientFixed");
            defs.appendChild(linearGradient);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "0%");
            stop.setAttribute("stop-color", "#5ae2ba");
            linearGradient.appendChild(stop);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "70%");
            stop.setAttribute("stop-color", "#fc6428");
            linearGradient.appendChild(stop);


            linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            linearGradient.setAttribute("id", "gradientLiving");
            defs.appendChild(linearGradient);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "0%");
            stop.setAttribute("stop-color", "#5ae2ba");
            linearGradient.appendChild(stop);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "70%");
            stop.setAttribute("stop-color", "#47e54a");
            linearGradient.appendChild(stop);


            linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            linearGradient.setAttribute("id", "gradientDebt");
            defs.appendChild(linearGradient);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "5%");
            stop.setAttribute("stop-color", "#fc6428");
            linearGradient.appendChild(stop);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "55%");
            stop.setAttribute("stop-color", "rgb(255, 59, 48)");
            linearGradient.appendChild(stop);


            linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            linearGradient.setAttribute("id", "gradientImportant");
            defs.appendChild(linearGradient);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "5%");
            stop.setAttribute("stop-color", "#fc6428");
            linearGradient.appendChild(stop);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "55%");
            stop.setAttribute("stop-color", "rgb(255, 149, 0)");
            linearGradient.appendChild(stop);


            linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            linearGradient.setAttribute("id", "gradientNotSoImportant");
            defs.appendChild(linearGradient);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "5%");
            stop.setAttribute("stop-color", "#fc6428");
            linearGradient.appendChild(stop);

            stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stop.setAttribute("offset", "55%");
            stop.setAttribute("stop-color", "rgb(255, 149, 0)");
            linearGradient.appendChild(stop);

            // Graph Properties
            graphWidth = chart.clientWidth - 160;
            graphHeight = chart.clientHeight;
            nodePadding = 18;

            maxChildNode = calculateMaxChildNode(nodes)
            maxNodeSum = calculateMaxNodeSum(nodes);
            scalingFactor = (graphHeight - (maxChildNode + 1) * nodePadding) / maxNodeSum;

            // Draw Values
            nodes.forEach(function(node, index) {
                x0 = index * graphWidth / nodes.length + (index == 0 ? nodePadding : 0);
                x1 = index + 1 < nodes.length ? (index + 1) * graphWidth / nodes.length : graphWidth - nodePadding;

                y0 = (graphHeight - (maxNodeSum * scalingFactor + (node.length - 1) * nodePadding)) / 2;
                y1 = index + 1 < nodes.length ? (graphHeight - (maxNodeSum * scalingFactor + (nodes[index + 1].length - 1) * nodePadding)) / 2 : nodePadding;

                node.forEach(function(child, childIndex) {
                    child.forEach(function(grandChild, grandChildIndex) {
                        value = grandChild[0] * scalingFactor;

                        // Draw Start Caps
                        if (index == 0) {
                            chart.appendChild(drawRect(x0 - 2, y0, 2, value, "#9c9e9d"));
                        }

                        // Draw End Caps
                        if ((index + 1 >= nodes.length)) {
                            chart.appendChild(drawRect(x1, y1, 2, value, "#9c9e9d"));
                        }

                        chart.appendChild(createCurve(x0 - 0.5, y0 + value / 2, x1, y1 + value / 2, value, grandChild[1]));

                        if (index + 1 >= nodes.length) {
                            chart.appendChild(drawText(x1 + 10, y1 + value / 2 + 4.0, grandChild[2] + " (" + formatForDisplay(grandChild[0]) + ")"));
                        } else if (index == 0) {
                            chart.appendChild(drawText(x0 + 10, y0 + value / 2 + 5.5, grandChild[2] + " (" + formatForDisplay(grandChild[0]) + ")"));
                        } else {
                            chart.appendChild(drawText(x0 + 20, y0 + value / 2 + 5.5, grandChild[2] + " (" + formatForDisplay(grandChild[0]) + ")"));
                        }

                        if ((index + 1 < nodes.length && childIndex < nodes[index + 1].length && nodes[index + 1].length > 1) || (index + 1 >= nodes.length)) {
                            y1 += nodePadding;
                        }

                        y0 += node[childIndex][grandChildIndex][0] * scalingFactor;
                        y1 += node[childIndex][grandChildIndex][0] * scalingFactor;
                    });

                    y0 += nodePadding;
                });
            });

            // Drawing Functions
            function createCurve(x0, y0, x1, y1, height, color) {
                if (y0 == y1) {
                    y1 += 0.001;
                }

                path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", "M " + x0 + " " + y0 + " C " + (x0 + (x1 - x0) / 2) + " " + y0 + " " + (x0 + (x1 - x0) / 2) + " " + y1 + " " + x1 + " " + y1);
                path.setAttribute("stroke-width", height + "px");
                path.setAttribute("stroke", color);
                path.setAttribute("fill", "none");
                return path;
            }

            function drawRect(x, y, w, h, fill) {
                rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("x", x);
                rect.setAttribute("y", y);
                rect.setAttribute("width", w);
                rect.setAttribute("height", h);
                rect.style.fill = fill;
                return rect;
            }

            function drawText(x, y, value) {
                text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", x);
                text.setAttribute("y", y);
                text.setAttribute("font-size", "12px");
                text.innerHTML = value;
                return text;
            }

            function calculateMaxNodeSum(nodes) {
                total = 0;
                nodes[0].forEach(function(child) {
                    total += child.reduce(function(accumulator, grandChild) {
                        return accumulator + grandChild[0];
                    }, 0);
                });

                return total;
            }

            function calculateMaxChildNode(nodes) {
                total = 0;
                nodes.forEach(function(node) {
                    nodeCount = node.reduce(function(accumulator, child) {
                        return accumulator + child.length;
                    }, 0);

                    total = nodeCount > total ? nodeCount : total;
                });

                return total;
            }

            return chart;
        }
    </script>
</head>

<body>
    <div class="container-fluid">
        <div class="page-header">
            <h1>Monthly Budget Visual Representation</h1>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">March 2017</div>
            <div class="panel-body">
                <div id="sankey_basic2" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">April 2017</div>
            <div class="panel-body">
                <div id="sankey_basic3" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">May 2017</div>
            <div class="panel-body">
                <div id="sankey_basic4" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">June 2017</div>
            <div class="panel-body">
                <div id="sankey_basic5" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">July 2017</div>
            <div class="panel-body">
                <div id="sankey_basic6" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">August 2017</div>
            <div class="panel-body">
                <div id="sankey_basic7" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">September 2017</div>
            <div class="panel-body">
                <div id="sankey_basic8" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">October 2017</div>
            <div class="panel-body">
                <div id="sankey_basic9" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">November 2017</div>
            <div class="panel-body">
                <div id="sankey_basic10" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">December 2017</div>
            <div class="panel-body">
                <div id="sankey_basic11" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">January 2018</div>
            <div class="panel-body">
                <div id="sankey_basic12" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

    </div>
    <script type="text/javascript">
        drawCharts();
    </script>

</body>

</html>