<html>

<head>
    <title>Tactical Money Planning - Visual</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        /* FORMATTING FUNCTIONS */

        function roundToTwoDecimalPlaces(number) {
            return Math.round(number * 100) / 100;
        }

        function formatForDisplay(number) {
            return roundToTwoDecimalPlaces(number).toLocaleString('en-ZA', {
                style: 'currency',
                currency: 'ZAR'
            });
        }

        /* FIXED DATA */
        incomeList = [{
            "name": "Ruan",
            value: 32062.77
        }, {
            "name": "Jessi",
            value: 11655
        }];

        fixedExpencesList = [{
            "name": "Rent",
            value: 8500
        }, {
            "name": "Car Payment",
            value: 4078.50
        }, {
            "name": "Medical Aid",
            value: 3129
        }, {
            "name": "Retirement Annuity",
            value: 1560
        }, {
            "name": "Domestic Work",
            value: 1500
        }, {
            "name": "Car/Household Insurance",
            value: 751.36
        }, {
            "name": "Income Protector",
            value: 645.05
        }, {
            "name": "Internet",
            value: 607.50
        }, {
            "name": "Electricity",
            value: 500
        }, {
            "name": "Municipal Rates",
            value: 500
        }, {
            "name": "Car Service Plan",
            value: 253.41
        }, {
            "name": "Bank Charges",
            value: 200
        }, {
            "name": "Websites",
            value: 118
        }];

        livingExpencesList = [{
            "name": "Groceries",
            value: 6775.95
        }, {
            "name": "Fun",
            value: 2500
        }, {
            "name": "Petrol",
            value: 2000
        }];

        google.charts.load('current', {
            'packages': ['sankey']
        });
        google.charts.setOnLoadCallback(drawCharts);

        function drawChart(root, incomeList, fixedExpencesList, livingExpencesList, savingExpencesList) {
            incomeString = "Income (" + formatForDisplay(incomeList.reduce(function(accumulator, entry) {
                return accumulator + entry.value;
            }, 0)) + ")";

            fixedExpencesString = "Fixed Expences (" + formatForDisplay(fixedExpencesList.reduce(function(accumulator, entry) {
                return accumulator + entry.value;
            }, 0)) + ")";

            fixedExpencesValue = roundToTwoDecimalPlaces(fixedExpencesList.reduce(function(accumulator, entry) {
                return accumulator + entry.value;
            }, 0));

            livingExpencesString = "Living Expences (" + formatForDisplay(livingExpencesList.reduce(function(accumulator, entry) {
                return accumulator + entry.value;
            }, 0)) + ")";

            livingExpencesValue = roundToTwoDecimalPlaces(livingExpencesList.reduce(function(accumulator, entry) {
                return accumulator + entry.value;
            }, 0));

            savingExpencesString = "Savings (" + formatForDisplay(savingExpencesList.reduce(function(accumulator, entry) {
                return accumulator + entry.value;
            }, 0)) + ")";

            savingExpencesValue = roundToTwoDecimalPlaces(savingExpencesList.reduce(function(accumulator, entry) {
                return accumulator + entry.value;
            }, 0));

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'From');
            data.addColumn('string', 'To');
            data.addColumn('number', 'Weight');

            rows = [];

            incomeList.forEach(function(entry) {
                rows.push([entry.name + " (" + formatForDisplay(entry.value) + ")", incomeString, entry.value]);
            });

            rows.push([incomeString, fixedExpencesString, fixedExpencesValue]);
            rows.push([incomeString, livingExpencesString, livingExpencesValue]);
            rows.push([incomeString, savingExpencesString, savingExpencesValue]);

            fixedExpencesList.forEach(function(entry) {
                rows.push([fixedExpencesString, entry.name + " (" + formatForDisplay(entry.value) + ")", entry.value]);
            });

            livingExpencesList.forEach(function(entry) {
                rows.push([livingExpencesString, entry.name + " (" + formatForDisplay(entry.value) + ")", entry.value]);
            });

            savingExpencesList.forEach(function(entry) {
                rows.push([savingExpencesString, entry.name + " (" + formatForDisplay(entry.value) + ")", entry.value]);
            });

            data.addRows(rows);

            // Sets chart options.
            var options = {
                sankey: {
                    node: {
                        interactivity: false,
                        nodePadding: 20,
                        width: 5,
                        label: {
                            fontSize: 15
                        },
                        interactivity: false
                    },
                }
            };

            var chart = new google.visualization.Sankey(root);
            chart.draw(data, options);
        }

        function drawCharts() {
            drawChart(document.getElementById("sankey_basic2"), incomeList, fixedExpencesList, livingExpencesList, [{
                "name": "Kia Rio Early Settlement",
                value: 10000
            }, {
                "name": "Kia Rio Early Settlement",
                value: 99
            }]);
            drawChart(document.getElementById("sankey_basic3"), incomeList, fixedExpencesList, livingExpencesList, [{
                "name": "House Fund",
                value: 10000
            }, {
                "name": "Kia Rio Early Settlement",
                value: 99
            }]);
            drawChart(document.getElementById("sankey_basic4"), incomeList, fixedExpencesList, livingExpencesList, [{
                "name": "Kamonande Fund",
                value: 10000
            }, {
                "name": "Kia Rio Early Settlement",
                value: 99
            }]);
        }
    </script>
</head>

<body>
    <div class="container-fluid">
        <div class="page-header">
            <h1>Monthly Budget Visual Representation</h1>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">March 2017</div>
            <div class="panel-body">
                <div id="sankey_basic2" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">April 2017</div>
            <div class="panel-body">
                <div id="sankey_basic3" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading">May 2017</div>
            <div class="panel-body">
                <div id="sankey_basic4" style="width: 100%; height: 500px;"></div>
            </div>
        </div>

    </div>
</body>

</html>